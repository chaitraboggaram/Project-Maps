<!DOCTYPE html>
<html>
    <head>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
        <link rel="stylesheet" href="give-4-good/src/index.css">
    </head>
    <body>
        <!-- <section class="map"> -->
            <!-- <div class="map-section"> -->
        <nav>
            <!-- Logo -->
            <a href="#" class="logo">
              <div id="logo">
                <img src="give-4-good/src/images/logo.JPG"></img>
              </div>
            </a>
    
            <!-- Navbar -->
            <ul>
              <li class="nav-item">
                <button onClick="Home()" class="nav-link">Home</button>
              </li>
              <li class="nav-item">
                <button onClick="About()" class="nav-link">About</button>
              </li>
              <li class="nav-item">
                <button onClick="Map()" class="nav-link">Map</button>
              </li>
              <li class="nav-item">
                <button onClick="Ngo()" class="nav-link">NGO</button>
              </li>
            </ul>
        </nav>

        <!-- MAP -->
        <div class="row">
            <div id="map"></div>
            <script>
                let pin = {lat: 0, lng:0};
                let map;
                let pos;
                let yourCircle;
                function initMap(){
                    const uluru = {lat: 37.3706687, lng: -122.002572};
                    map = new google.maps.Map(document.getElementById("map"), {
                        zoom : 12, 
                        center: uluru,
                        streetViewControl: false,
                        draggableCursor: "crosshair"
                        }
                    );
                    infoWindow = new google.maps.InfoWindow();
                    const locationButton = document.createElement("button");

                    var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
                    var icons = {
                        icon: iconBase + 'parking_lot_maps.png'
                    };

                    let random_json = {lat: 37.3786925 , lng: -122.0051036};
                    let marker = new google.maps.Marker({position: random_json, map: map, anchor: new google.maps.Point(0, 20),
                    });

                    locationButton.textContent = "Pan to Current Location";
                    locationButton.classList.add("custom-map-control-button");
                    map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
                    locationButton.addEventListener("click", () => {
                        // Try HTML5 geolocation.
                        if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                pos = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude,
                                };

                                infoWindow.setPosition(pos);
                                infoWindow.setContent("Location found.");
                                pin = pos;
                                console.log("lat: "+pos.lat);
                                infoWindow.open(map);
                                map.setCenter(pos);
                                let marker = new google.maps.Marker({position: pos, map: map, 
                                });
                                // yourCircle = new google.maps.Circle({
                                //     strokeColor: "#FF0000",
                                //     strokeOpacity: 0.8,
                                //     strokeWeight: 2,
                                //     fillColor: "#FF0000",
                                //     fillOpacity: 0.25,
                                //     map,
                                //     center: pos,
                                //     radius: 1000,
                                //     zoom: 50,
                                // });
                            },
                            () => {
                            handleLocationError(true, infoWindow, map.getCenter());
                            }
                        );
                        } else {
                        // Browser doesn't support Geolocation
                        handleLocationError(false, infoWindow, map.getCenter());
                        }
                    });
                    window.initMap = initMap;
                    // initialiseSpots();

                    google.maps.event.addListener(map, 'click', function( event ){
                        pin = {
                            lat: event.latLng.lat(),
                            lng: event.latLng.lng()
                        };
                        alert( "Latitude: "+pin.lat+" "+", longitude: "+pin.lng ); 
                        let rev_geocode = 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+pin.lat+','+pin.lng+'&key=AIzaSyBQ0BaHgPmtPiIYxqldB3DK-t8jl9Brq7M';
                        let pin_json = fetch(rev_geocode)
                            .then(response => response.text())
                            .then(text => console.log(text));
                        
                    });

                    }

                    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                            infoWindow.setPosition(pos);
                            infoWindow.setContent(
                                browserHasGeolocation
                                ? "Error: The Geolocation service failed."
                                : "Error: Your browser doesn't support geolocation."
                            );
                            infoWindow.open(map);
                    }

                    // function initialiseSpots() {
                    //     let random_json = {lat: 37.3786925 , lng: -122.0051036};
                    //     let marker = new google.maps.Marker({position: random_json, map: map,  
                    //     });
                    // }
                function Home() {
                    window.location.href = "http://localhost:3000/";
                }

                function About() {
                    window.location.href = "http://localhost:3000/about";
                }

                function Map() {
                    window.location.href = "";
                }

                function Ngo() {
                    window.location.href = "http://localhost:3000/ngo";
                }
            </script>
            <script async
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQ0BaHgPmtPiIYxqldB3DK-t8jl9Brq7M&callback=initMap">
            </script>
                </div>
            <!-- </div> -->
        <!-- </section> -->
    </body>
</html>